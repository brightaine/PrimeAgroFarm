<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Prime Agro Farm</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <style>
        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        .logout-btn {
            background-color: #d32f2f;
            color: #ffffff;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
        }
        .logout-btn:hover {
            background-color: #b71c1c;
        }
        .section {
            background-color: #ffffff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        .section h3 {
            color: #2e7d32;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }
        .form-group input, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: 'Open Sans', sans-serif;
        }
        .form-group textarea {
            height: 100px;
            resize: vertical;
        }
        .news-preview-card {
            background-color: #ffffff;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: relative;
        }
        .news-preview-card .delete-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #d32f2f;
            color: #ffffff;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.8em;
        }
        .news-preview-card .edit-btn {
            background-color: #2e7d32;
            color: #ffffff;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.8em;
        }
        .news-preview-card .edit-btn:hover {
            background-color: #1b5e20;
        }
        .news-preview-card .delete-btn {
            background-color: #d32f2f;
            color: #ffffff;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.8em;
        }
        .news-preview-card .delete-btn:hover {
            background-color: #b71c1c;
        }
        .delete-btn {
            background-color: #d32f2f;
            color: #ffffff;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
        }
        .engagement-item {
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
        }
        .engagement-item h4 {
            margin: 0 0 10px 0;
            color: #2e7d32;
        }
        .comment {
            background-color: #f9f9f9;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
            border-left: 4px solid #8d6e63;
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <div class="logo">
                <h1>Prime Agro Farm - Admin</h1>
            </div>
            <ul class="nav-links">
                <li><a href="index.html">Back to Site</a></li>
            </ul>
        </nav>
    </header>

    <main class="admin-container">
        <div class="admin-header">
            <h2>Admin Dashboard</h2>
            <button class="logout-btn" onclick="logout()">Logout</button>
        </div>

        <div class="section">
            <h3>Add New News</h3>
            <form id="add-news-form">
                <div class="form-group">
                    <label for="title">Title</label>
                    <input type="text" id="title" required>
                </div>
                <div class="form-group">
                    <label for="description">Description</label>
                    <textarea id="description" required></textarea>
                </div>
                <div class="form-group">
                    <label for="image">Image</label>
                    <input type="file" id="image" accept="image/*" required>
                    <small style="color: #666; display: block; margin-top: 5px;">Select an image from your device</small>
                </div>
                <button type="submit" class="btn">Add News</button>
            </form>
        </div>

        <div class="section">
            <h3>Manage News</h3>
            <div id="news-list"></div>
        </div>

        <div class="section">
            <h3>View Engagements</h3>
            <div id="engagements-list"></div>
        </div>
    </main>

    <!-- Edit News Modal -->
    <div id="edit-modal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <span class="close-btn" id="edit-close-btn">&times;</span>
            <h3>Edit News</h3>
            <form id="edit-news-form">
                <div class="form-group">
                    <label for="edit-title">Title</label>
                    <input type="text" id="edit-title" required>
                </div>
                <div class="form-group">
                    <label for="edit-description">Description</label>
                    <textarea id="edit-description" required></textarea>
                </div>
                <div class="form-group">
                    <label for="edit-image">Image (leave empty to keep current)</label>
                    <input type="file" id="edit-image" accept="image/*">
                    <small style="color: #666; display: block; margin-top: 5px;">Select a new image or leave empty to keep the current one</small>
                </div>
                <button type="submit" class="btn">Update News</button>
            </form>
        </div>
    </div>

    <script>
        // Check if logged in
        if (!sessionStorage.getItem('adminLoggedIn')) {
            window.location.href = 'admin-login.html';
        }

        function logout() {
            sessionStorage.removeItem('adminLoggedIn');
            window.location.href = 'index.html';
        }

        // Load news
        function loadNews() {
            const news = JSON.parse(localStorage.getItem('adminNews') || '[]');
            const newsList = document.getElementById('news-list');
            newsList.innerHTML = '';
            news.forEach((item, index) => {
                const newsItem = document.createElement('div');
                newsItem.className = 'news-preview-card';
                newsItem.innerHTML = `
                    <img src="${item.image}" alt="News Image" style="width: 100%; height: 150px; object-fit: cover; border-radius: 5px;">
                    <h4 style="color: #2e7d32; margin: 10px 0 5px 0;">${item.title}</h4>
                    <p style="color: #666; margin: 0 0 10px 0; font-size: 0.9em;">${item.description.substring(0, 100)}${item.description.length > 100 ? '...' : ''}</p>
                    <div style="display: flex; gap: 10px;">
                        <button class="edit-btn" onclick="editNews(${index})">Edit</button>
                        <button class="delete-btn" onclick="deleteNews(${index})">Delete</button>
                    </div>
                `;
                newsList.appendChild(newsItem);
            });
        }

        // Load engagements
        function loadEngagements() {
            const likes = JSON.parse(localStorage.getItem('newsLikes') || '{}');
            const comments = JSON.parse(localStorage.getItem('newsComments') || '{}');
            const defaultNews = [
                { id: 1, title: 'Sustainable Farming Practices Implemented', description: 'We have implemented advanced irrigation systems and organic pest control methods to ensure our crops are grown sustainably, reducing environmental impact while maintaining high yields. This initiative supports our commitment to eco-friendly agriculture in Zirobwe.', image: 'https://images.unsplash.com/photo-1500382017468-9049fed747ef?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80' },
                { id: 2, title: 'New Community Outreach Program', description: 'Our new community outreach program focuses on educating local farmers about modern dairy techniques and sustainable practices. Through workshops and training sessions, we\'re empowering the Zirobwe community to improve their agricultural productivity and livelihoods.', image: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80' },
                { id: 3, title: 'Milking Technology Upgrades', description: 'We\'ve upgraded our milking parlors with state-of-the-art automated systems that ensure hygienic milk collection and improve cow comfort. This technology enhances milk quality and increases efficiency in our daily operations at Prime Agro Farm.', image: 'https://images.unsplash.com/photo-1550583724-b2692b85b150?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80' },
                { id: 4, title: 'Annual Harvest Festival Announced', description: 'Join us for our annual harvest festival celebrating the bountiful yields from our sustainable farming efforts. The event will feature local produce displays, dairy product tastings, and educational sessions on modern agricultural practices in Zirobwe.', image: 'https://images.unsplash.com/photo-1500651230702-0e2d8a49d4ad?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80' },
                { id: 5, title: 'Partnership with Local Schools', description: 'Prime Agro Farm has partnered with local schools in Zirobwe to provide hands-on agricultural education. Students will learn about dairy farming, crop cultivation, and sustainable practices through field trips and interactive workshops at our facility.', image: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80' },
                { id: 6, title: 'Environmental Impact Report', description: 'Our latest environmental impact report shows significant improvements in water conservation and reduced carbon footprint through our sustainable farming initiatives. We\'re proud to contribute to a greener Zirobwe while maintaining agricultural productivity.', image: 'https://images.unsplash.com/photo-1500382017468-9049fed747ef?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80' }
            ];
            const adminNews = JSON.parse(localStorage.getItem('adminNews') || '[]');
            const allNews = [...defaultNews, ...adminNews.map((item, index) => ({ ...item, id: 7 + index }))];

            const engagementsList = document.getElementById('engagements-list');
            engagementsList.innerHTML = '';

            for (let newsId in comments) {
                const newsItem = allNews.find(news => news.id == newsId);
                const engagementItem = document.createElement('div');
                engagementItem.className = 'engagement-item';

                if (newsItem) {
                    engagementItem.innerHTML = `
                        <div style="display: flex; align-items: center; margin-bottom: 15px;">
                            <img src="${newsItem.image}" alt="News Image" style="width: 80px; height: 60px; object-fit: cover; border-radius: 5px; margin-right: 15px;">
                            <div>
                                <h4 style="margin: 0; color: #2e7d32;">${newsItem.title}</h4>
                                <p style="margin: 5px 0; color: #666; font-size: 0.9em;">Likes: ${likes[newsId] || 0} | Comments: ${comments[newsId].length}</p>
                            </div>
                        </div>
                    `;
                } else {
                    engagementItem.innerHTML = `<h4>News ID: ${newsId} (Likes: ${likes[newsId] || 0})</h4>`;
                }

                comments[newsId].forEach(comment => {
                    const commentDiv = document.createElement('div');
                    commentDiv.className = 'comment';
                    commentDiv.innerHTML = `
                        <strong>${comment.name}</strong> (${comment.email})<br>
                        ${comment.comment}<br>
                        <small>${new Date(comment.date).toLocaleDateString()}</small>
                    `;
                    engagementItem.appendChild(commentDiv);
                });
                engagementsList.appendChild(engagementItem);
            }
        }

        // Add news
        document.getElementById('add-news-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const title = document.getElementById('title').value;
            const description = document.getElementById('description').value;
            const imageFile = document.getElementById('image').files[0];

            if (imageFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imageDataUrl = e.target.result;
                    const news = JSON.parse(localStorage.getItem('adminNews') || '[]');
                    news.push({ title, description, image: imageDataUrl });
                    localStorage.setItem('adminNews', JSON.stringify(news));

                    document.getElementById('add-news-form').reset();
                    loadNews();
                };
                reader.readAsDataURL(imageFile);
            }
        });

        // Delete news
        function deleteNews(index) {
            const news = JSON.parse(localStorage.getItem('adminNews') || '[]');
            news.splice(index, 1);
            localStorage.setItem('adminNews', JSON.stringify(news));
            loadNews();
        }

        // Edit news
        function editNews(index) {
            const news = JSON.parse(localStorage.getItem('adminNews') || '[]');
            const item = news[index];

            // Populate form with current data
            document.getElementById('edit-title').value = item.title;
            document.getElementById('edit-description').value = item.description;

            // Store the index for updating
            document.getElementById('edit-news-form').dataset.editIndex = index;

            // Show modal
            document.getElementById('edit-modal').style.display = 'block';
        }

        // Handle edit form submission
        document.getElementById('edit-news-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const index = parseInt(this.dataset.editIndex);
            const title = document.getElementById('edit-title').value;
            const description = document.getElementById('edit-description').value;
            const imageFile = document.getElementById('edit-image').files[0];

            const news = JSON.parse(localStorage.getItem('adminNews') || '[]');

            if (imageFile) {
                // New image uploaded
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imageDataUrl = e.target.result;
                    news[index] = { title, description, image: imageDataUrl };
                    localStorage.setItem('adminNews', JSON.stringify(news));
                    document.getElementById('edit-modal').style.display = 'none';
                    loadNews();
                };
                reader.readAsDataURL(imageFile);
            } else {
                // Keep existing image
                news[index] = { title, description, image: news[index].image };
                localStorage.setItem('adminNews', JSON.stringify(news));
                document.getElementById('edit-modal').style.display = 'none';
                loadNews();
            }
        });

        // Close edit modal
        document.getElementById('edit-close-btn').onclick = function() {
            document.getElementById('edit-modal').style.display = 'none';
        };

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('edit-modal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        };

        // Initial load
        loadNews();
        loadEngagements();
    </script>
</body>
</html>